<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Hack In Paris Challenge 3 &mdash; HIPChall 2016 write-up</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="HIPChall 2016 write-up" href="index.html" />
    <link rel="next" title="Hack In Paris Challenge 4" href="challenge4.html" />
    <link rel="prev" title="Hack In Paris Challenge 2" href="challenge2.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>HIPChall 2016 write-up</span></a></h1>
        <h2 class="heading"><span>Hack In Paris Challenge 3</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="challenge2.html">Hack In Paris Challenge 2</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="challenge4.html">Hack In Paris Challenge 4</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="hack-in-paris-challenge-3">
<h1>Hack In Paris Challenge 3<a class="headerlink" href="#hack-in-paris-challenge-3" title="Permalink to this headline">¶</a></h1>
<p>The challenge began on Friday March, 4th, with a <a class="reference external" href="https://twitter.com/hackinparis/status/705869825009197056">tweet</a> which appeared at 13:37:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>No, just had a setback!
READY? Here it is!
#HIPChall n°3
https://hackinparis.com/challenge-3.html …
</pre></div>
</div>
<p>The web page given by the tweet contains the following message:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Hi !

I really like old-school games like space invaders.
I was looking for the new version of Tetris, however it seems that it&#39;s not
Tetris but a secret game used by a secret group !
When I launched the game, it asked for a password... So I tried to use my
reverse-engineering skills to find the password, but IDA won&#39;t load this
file... :(
Can you help me find the password ?

 https://hackinparis.com/data/chall2016/step-3/output.c16

The fingerprints for output.c16 :

 md5 e85b598ea1e89816c2264105f964c26a
 sha256 1bfbb466e645b04d533df2b0834cbe52f18389e56896b1bf0b4b219707d7a017

Please send your conclusions (and the validation flag) to
merenwen@hackinparis.com
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">output.c16</span></code> is a 8926-byte file containing the following strings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ strings output.c16
CH16
Hack In Paris - CHIP16 !                merenwen@hackinparis.com
Please, enter the password :
Bad password !
You lucky bastard.
</pre></div>
</div>
<p>CHIP16 refers to a kind of hardware which has been used to run games.
It uses an RISC instruction set which uses 16-bit addresses and 32-bit instructions.
More information can be found at this really well-written and short wiki: <a class="reference external" href="https://github.com/chip16/chip16">https://github.com/chip16/chip16</a></p>
<p>More precisely, here is some information which is quite useful to analyze the given ROM file:</p>
<ul class="simple">
<li>The ROM is loaded at address <code class="docutils literal"><span class="pre">0x0000</span></code>.</li>
<li>The stack is 512-byte-long and starts at <code class="docutils literal"><span class="pre">0xFDF0</span></code>.</li>
<li>There are Input/Output ports starting at <code class="docutils literal"><span class="pre">0xFFF0</span></code>, and the byte at this address is used to read the state of a game controller.</li>
<li>The screen resolution is 320x240.  It is updated at a frequency of 60 Hz, and there is an instruction, <code class="docutils literal"><span class="pre">VBLNK</span></code>, which waits for the next VBLANK signal (which advertises every frame).</li>
</ul>
<p><a class="reference external" href="https://github.com/chip16/chip16/wiki/Machine-Specification">https://github.com/chip16/chip16/wiki/Machine-Specification</a> describes Chip16 file format, with the following 16-byte header:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Offset</span>  <span class="n">Size</span>    <span class="n">Meaning</span>
<span class="mh">0x00</span>    <span class="mi">4</span>       <span class="n">Magic</span> <span class="n">number</span> <span class="p">(</span><span class="s1">&#39;CH16&#39;</span><span class="p">)</span>
<span class="mh">0x04</span>    <span class="mi">1</span>       <span class="n">Reserved</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="mh">0x05</span>    <span class="mi">1</span>       <span class="n">Specification</span> <span class="n">version</span> <span class="n">H</span><span class="o">.</span><span class="n">L</span> <span class="p">(</span><span class="mi">0</span><span class="n">xHL</span><span class="p">)</span>
<span class="mh">0x06</span>    <span class="mi">4</span>       <span class="n">ROM</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">header</span><span class="p">)</span>
<span class="mh">0x0A</span>    <span class="mi">2</span>       <span class="n">Start</span> <span class="n">address</span> <span class="p">(</span><span class="n">initial</span> <span class="n">value</span> <span class="n">of</span> <span class="n">PC</span> <span class="n">register</span><span class="p">)</span>
<span class="mh">0x0C</span>    <span class="mi">4</span>       <span class="n">CRC32</span> <span class="n">checksum</span> <span class="n">of</span> <span class="n">ROM</span> <span class="p">(</span><span class="n">excluding</span> <span class="n">header</span><span class="p">)</span> <span class="p">(</span><span class="n">polynomial</span><span class="p">:</span> <span class="mh">0x04C11DB7</span><span class="p">)</span>
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">output.c16</span></code>, the first 16 bytes are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">43</span> <span class="mi">48</span> <span class="mi">31</span> <span class="mi">36</span> <span class="p">:</span> <span class="s2">&quot;CH16&quot;</span>
<span class="mi">00</span>          <span class="p">:</span> <span class="p">(</span><span class="n">reserved</span><span class="p">)</span>
<span class="mi">11</span>          <span class="p">:</span> <span class="n">Use</span> <span class="n">spec</span> <span class="mf">1.1</span>
<span class="n">ce</span> <span class="mi">22</span> <span class="mi">00</span> <span class="mi">00</span> <span class="p">:</span> <span class="n">ROM</span> <span class="n">Size</span> <span class="n">without</span> <span class="n">header</span> <span class="mh">0x22ce</span> <span class="o">=</span> <span class="mi">8910</span> <span class="nb">bytes</span>
<span class="mi">00</span> <span class="mi">00</span>       <span class="p">:</span> <span class="n">Start</span> <span class="n">address</span> <span class="p">(</span><span class="mh">0x0000</span><span class="p">)</span>
<span class="mi">47</span> <span class="n">d3</span> <span class="mi">6</span><span class="n">c</span> <span class="mi">2</span><span class="n">d</span> <span class="p">:</span> <span class="n">CRC32</span> <span class="n">checksum</span>
</pre></div>
</div>
<p>With the information of the wiki it is possible to disassemble the ROM.
As CHIP16 assembly code is not very easily readable, I implemented an instruction decoder in pseudo-code, which was written in Python.</p>
<div class="section" id="disassemble-the-rom">
<h2>Disassemble the ROM<a class="headerlink" href="#disassemble-the-rom" title="Permalink to this headline">¶</a></h2>
<p>The execution of the ROM starts at address <code class="docutils literal"><span class="pre">0x0000</span></code> (according to the file header) with the following instruction:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">0000</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">7</span><span class="n">a</span> <span class="mi">02</span>    <span class="n">call</span> <span class="mh">0x027a</span>
</pre></div>
</div>
<p>It thus calls a function at <code class="docutils literal"><span class="pre">0x027a</span></code>, which is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">027</span><span class="n">a</span><span class="p">:</span> <span class="n">c0</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">push</span> <span class="n">R0</span>
<span class="mi">027</span><span class="n">e</span><span class="p">:</span> <span class="n">c0</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">push</span> <span class="n">R1</span>
<span class="mi">0282</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">00</span> <span class="mi">4</span><span class="n">c</span> <span class="mi">03</span>    <span class="n">R0</span> <span class="o">&lt;-</span> <span class="mh">0x034c</span>
<span class="mi">0286</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">01</span> <span class="n">ca</span> <span class="mi">02</span>    <span class="n">R1</span> <span class="o">&lt;-</span> <span class="mh">0x02ca</span> <span class="p">;</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">welcome</span> <span class="n">message</span>
<span class="mi">028</span><span class="n">a</span><span class="p">:</span> <span class="mi">31</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="o">*</span><span class="p">[</span><span class="n">R0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">R1</span>
<span class="mi">028</span><span class="n">e</span><span class="p">:</span> <span class="mi">40</span> <span class="mi">00</span> <span class="mi">02</span> <span class="mi">00</span>    <span class="n">R0</span> <span class="o">+=</span> <span class="mh">0x0002</span>
<span class="mi">0292</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">01</span> <span class="mi">0</span><span class="n">b</span> <span class="mi">03</span>    <span class="n">R1</span> <span class="o">&lt;-</span> <span class="mh">0x030b</span> <span class="p">;</span> <span class="n">addr</span> <span class="n">of</span> <span class="s2">&quot;Please, enter the password :&quot;</span>
<span class="mi">0296</span><span class="p">:</span> <span class="mi">31</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="o">*</span><span class="p">[</span><span class="n">R0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">R1</span>
<span class="mi">029</span><span class="n">a</span><span class="p">:</span> <span class="mi">40</span> <span class="mi">00</span> <span class="mi">02</span> <span class="mi">00</span>    <span class="n">R0</span> <span class="o">+=</span> <span class="mh">0x0002</span>
<span class="mi">029</span><span class="n">e</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">01</span> <span class="mi">28</span> <span class="mi">03</span>    <span class="n">R1</span> <span class="o">&lt;-</span> <span class="mh">0x0328</span> <span class="p">;</span> <span class="n">addr</span> <span class="n">of</span> <span class="s2">&quot;*&quot;</span>
<span class="mi">02</span><span class="n">a2</span><span class="p">:</span> <span class="mi">31</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="o">*</span><span class="p">[</span><span class="n">R0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">R1</span>
<span class="mi">02</span><span class="n">a6</span><span class="p">:</span> <span class="mi">40</span> <span class="mi">00</span> <span class="mi">02</span> <span class="mi">00</span>    <span class="n">R0</span> <span class="o">+=</span> <span class="mh">0x0002</span>
<span class="mi">02</span><span class="n">aa</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">01</span> <span class="mi">2</span><span class="n">a</span> <span class="mi">03</span>    <span class="n">R1</span> <span class="o">&lt;-</span> <span class="mh">0x032a</span> <span class="p">;</span> <span class="n">addr</span> <span class="n">of</span> <span class="s2">&quot;Bad Password !&quot;</span>
<span class="mi">02</span><span class="n">ae</span><span class="p">:</span> <span class="mi">31</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="o">*</span><span class="p">[</span><span class="n">R0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">R1</span>
<span class="mi">02</span><span class="n">b2</span><span class="p">:</span> <span class="mi">40</span> <span class="mi">00</span> <span class="mi">02</span> <span class="mi">00</span>    <span class="n">R0</span> <span class="o">+=</span> <span class="mh">0x0002</span>
<span class="mi">02</span><span class="n">b6</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">01</span> <span class="mi">39</span> <span class="mi">03</span>    <span class="n">R1</span> <span class="o">&lt;-</span> <span class="mh">0x0339</span> <span class="p">;</span> <span class="n">addr</span> <span class="n">of</span> <span class="s2">&quot;You lucky bastard.&quot;</span>
<span class="mi">02</span><span class="n">ba</span><span class="p">:</span> <span class="mi">31</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="o">*</span><span class="p">[</span><span class="n">R0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">R1</span>
<span class="mi">02</span><span class="n">be</span><span class="p">:</span> <span class="n">c1</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">pop</span> <span class="n">R1</span>
<span class="mi">02</span><span class="n">c2</span><span class="p">:</span> <span class="n">c1</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">pop</span> <span class="n">R0</span>
<span class="mi">02</span><span class="n">c6</span><span class="p">:</span> <span class="mi">15</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="k">return</span>
</pre></div>
</div>
<p>This code copies 5 pointers to ASCII strings into a 10-byte array (5 2-byte items) at <code class="docutils literal"><span class="pre">0x034c</span></code>.</p>
<p>Then the execute resumes back to <code class="docutils literal"><span class="pre">0x0004</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">0004</span><span class="p">:</span> <span class="mi">03</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">Set</span> <span class="n">BG</span> <span class="n">color</span> <span class="n">to</span> <span class="mi">0</span>
<span class="mi">0008</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">0</span><span class="n">b</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">R11</span> <span class="o">&lt;-</span> <span class="mh">0x0000</span>
<span class="mi">000</span><span class="n">c</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">0</span><span class="n">c</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">R12</span> <span class="o">&lt;-</span> <span class="mh">0x0000</span>
<span class="mi">0010</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">03</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">R3</span> <span class="o">&lt;-</span> <span class="mh">0x0000</span>
<span class="mi">0014</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">0</span><span class="n">a</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">R10</span> <span class="o">&lt;-</span> <span class="mh">0x0000</span>
<span class="mi">0018</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">68</span> <span class="mi">01</span>    <span class="n">call</span> <span class="mh">0x0168</span><span class="o">&lt;</span><span class="n">draw_str_from_bank</span><span class="p">[</span><span class="n">r10</span><span class="p">]</span><span class="n">_and_newline</span><span class="o">&gt;</span>
<span class="mi">001</span><span class="n">c</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">0</span><span class="n">a</span> <span class="mi">01</span> <span class="mi">00</span>    <span class="n">R10</span> <span class="o">&lt;-</span> <span class="mh">0x0001</span>
<span class="mi">0020</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">68</span> <span class="mi">01</span>    <span class="n">call</span> <span class="mh">0x0168</span><span class="o">&lt;</span><span class="n">draw_str_from_bank</span><span class="p">[</span><span class="n">r10</span><span class="p">]</span><span class="n">_and_newline</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This initializes some registers and calls a function at <code class="docutils literal"><span class="pre">0x0168</span></code>, which I named <code class="docutils literal"><span class="pre">draw_str_from_bank[r10]_and_newline</span></code> because its analysis reveals it draws the characters of the string at index R10 in the array at <code class="docutils literal"><span class="pre">0x034c</span></code>, followed by a new line.
Here this function is called twice, with R10=0 at first, and R10=1 secondly.
This produces the following output on the screen:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Hack In Paris - CHIP16!
merenwen@hackinparis.com
Please, enter the password :
</pre></div>
</div>
<p>Then the following code is executed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">0024</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">0</span><span class="n">a</span> <span class="mi">05</span> <span class="mi">00</span>    <span class="n">R10</span> <span class="o">&lt;-</span> <span class="mh">0x0005</span>
<span class="mi">0028</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">62</span> <span class="mi">02</span>    <span class="n">call</span> <span class="mh">0x0262</span><span class="o">&lt;</span><span class="n">sleep</span><span class="p">(</span><span class="n">R10</span><span class="p">)</span><span class="o">&gt;</span>
<span class="mi">002</span><span class="n">c</span><span class="p">:</span> <span class="n">c0</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">push</span> <span class="n">R15</span>
<span class="mi">0030</span><span class="p">:</span> <span class="mi">22</span> <span class="mi">0</span><span class="n">f</span> <span class="n">f0</span> <span class="n">ff</span>    <span class="n">R15</span> <span class="o">&lt;-</span> <span class="o">*</span><span class="p">[</span><span class="mh">0xfff0</span><span class="p">]</span> <span class="p">;</span> <span class="n">Read</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="nb">input</span>
<span class="mi">0034</span><span class="p">:</span> <span class="mi">60</span> <span class="mi">0</span><span class="n">f</span> <span class="n">ff</span> <span class="mi">00</span>    <span class="n">R15</span> <span class="o">&amp;=</span> <span class="mh">0x00ff</span>
<span class="mi">0038</span><span class="p">:</span> <span class="mi">12</span> <span class="mi">00</span> <span class="mi">44</span> <span class="mi">00</span>    <span class="k">if</span> <span class="n">cond0</span><span class="p">,</span> <span class="n">jmp</span> <span class="mh">0x0044</span>
<span class="mi">003</span><span class="n">c</span><span class="p">:</span> <span class="n">c1</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">pop</span> <span class="n">R0</span>
<span class="mi">0040</span><span class="p">:</span> <span class="mi">10</span> <span class="mi">00</span> <span class="mi">48</span> <span class="mi">00</span>    <span class="n">jmp</span> <span class="mh">0x0048</span>
<span class="mi">0044</span><span class="p">:</span> <span class="n">c1</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">pop</span> <span class="n">R0</span>

<span class="mi">0048</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">0</span><span class="n">a</span> <span class="mi">02</span> <span class="mi">00</span>    <span class="n">R10</span> <span class="o">&lt;-</span> <span class="mh">0x0002</span> <span class="p">;</span> <span class="n">index</span> <span class="n">of</span> <span class="s2">&quot;*&quot;</span>
<span class="mi">004</span><span class="n">c</span><span class="p">:</span> <span class="mi">63</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">01</span> <span class="mi">00</span>    <span class="n">Test</span><span class="p">(</span><span class="n">R15</span> <span class="o">&amp;</span> <span class="mh">0x0001</span><span class="p">)</span>
<span class="mi">0050</span><span class="p">:</span> <span class="mi">12</span> <span class="mi">00</span> <span class="mi">5</span><span class="n">c</span> <span class="mi">00</span>    <span class="k">if</span> <span class="n">cond0</span><span class="p">,</span> <span class="n">jmp</span> <span class="mh">0x005c</span>
<span class="mi">0054</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">84</span> <span class="mi">01</span>    <span class="n">call</span> <span class="mh">0x0184</span><span class="o">&lt;</span><span class="n">draw_str_from_bank</span><span class="p">[</span><span class="n">r10</span><span class="p">]</span><span class="n">_and_r3</span><span class="o">+=</span><span class="mi">1</span><span class="o">&gt;</span>
<span class="mi">0058</span><span class="p">:</span> <span class="n">c0</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">push</span> <span class="n">R15</span>

<span class="mi">005</span><span class="n">c</span><span class="p">:</span> <span class="mi">63</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">02</span> <span class="mi">00</span>    <span class="n">Test</span><span class="p">(</span><span class="n">R15</span> <span class="o">&amp;</span> <span class="mh">0x0002</span><span class="p">)</span>
<span class="mi">0060</span><span class="p">:</span> <span class="mi">12</span> <span class="mi">00</span> <span class="mi">6</span><span class="n">c</span> <span class="mi">00</span>    <span class="k">if</span> <span class="n">cond0</span><span class="p">,</span> <span class="n">jmp</span> <span class="mh">0x006c</span>
<span class="mi">0064</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">84</span> <span class="mi">01</span>    <span class="n">call</span> <span class="mh">0x0184</span><span class="o">&lt;</span><span class="n">draw_str_from_bank</span><span class="p">[</span><span class="n">r10</span><span class="p">]</span><span class="n">_and_r3</span><span class="o">+=</span><span class="mi">1</span><span class="o">&gt;</span>
<span class="mi">0068</span><span class="p">:</span> <span class="n">c0</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">push</span> <span class="n">R15</span>

<span class="mi">006</span><span class="n">c</span><span class="p">:</span> <span class="mi">63</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">04</span> <span class="mi">00</span>    <span class="n">Test</span><span class="p">(</span><span class="n">R15</span> <span class="o">&amp;</span> <span class="mh">0x0004</span><span class="p">)</span>
<span class="mi">0070</span><span class="p">:</span> <span class="mi">12</span> <span class="mi">00</span> <span class="mi">7</span><span class="n">c</span> <span class="mi">00</span>    <span class="k">if</span> <span class="n">cond0</span><span class="p">,</span> <span class="n">jmp</span> <span class="mh">0x007c</span>
<span class="mi">0074</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">84</span> <span class="mi">01</span>    <span class="n">call</span> <span class="mh">0x0184</span><span class="o">&lt;</span><span class="n">draw_str_from_bank</span><span class="p">[</span><span class="n">r10</span><span class="p">]</span><span class="n">_and_r3</span><span class="o">+=</span><span class="mi">1</span><span class="o">&gt;</span>
<span class="mi">0078</span><span class="p">:</span> <span class="n">c0</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">push</span> <span class="n">R15</span>

<span class="mi">007</span><span class="n">c</span><span class="p">:</span> <span class="mi">63</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">08</span> <span class="mi">00</span>    <span class="n">Test</span><span class="p">(</span><span class="n">R15</span> <span class="o">&amp;</span> <span class="mh">0x0008</span><span class="p">)</span>
<span class="mi">0080</span><span class="p">:</span> <span class="mi">12</span> <span class="mi">00</span> <span class="mi">8</span><span class="n">c</span> <span class="mi">00</span>    <span class="k">if</span> <span class="n">cond0</span><span class="p">,</span> <span class="n">jmp</span> <span class="mh">0x008c</span>
<span class="mi">0084</span><span class="p">:</span> <span class="mi">14</span> <span class="mi">00</span> <span class="mi">84</span> <span class="mi">01</span>    <span class="n">call</span> <span class="mh">0x0184</span><span class="o">&lt;</span><span class="n">draw_str_from_bank</span><span class="p">[</span><span class="n">r10</span><span class="p">]</span><span class="n">_and_r3</span><span class="o">+=</span><span class="mi">1</span><span class="o">&gt;</span>
<span class="mi">0088</span><span class="p">:</span> <span class="n">c0</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">push</span> <span class="n">R15</span>

<span class="mi">008</span><span class="n">c</span><span class="p">:</span> <span class="mi">20</span> <span class="mi">0</span><span class="n">f</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="n">R15</span> <span class="o">&lt;-</span> <span class="mh">0x0000</span>
<span class="mi">0090</span><span class="p">:</span> <span class="mi">53</span> <span class="mi">03</span> <span class="mi">08</span> <span class="mi">00</span>    <span class="n">Cmp</span><span class="p">(</span><span class="n">R3</span> <span class="o">-</span> <span class="mh">0x0008</span><span class="p">)</span>
<span class="mi">0094</span><span class="p">:</span> <span class="mi">12</span> <span class="mi">00</span> <span class="mi">9</span><span class="n">c</span> <span class="mi">00</span>    <span class="k">if</span> <span class="n">Z</span><span class="p">,</span> <span class="n">jmp</span> <span class="mh">0x009c</span>
<span class="mi">0098</span><span class="p">:</span> <span class="mi">10</span> <span class="mi">00</span> <span class="mi">24</span> <span class="mi">00</span>    <span class="n">jmp</span> <span class="mh">0x0024</span>
</pre></div>
</div>
<p>This is a loop (it ends with a jump to the beginning) which waits for 8 key presses from the first controller (which input is read from address <code class="docutils literal"><span class="pre">0xfff0</span></code>).
For each key pressed, it prints a star on the screen, increases R3 by 1 and pushes the key value onto the stack.
Once 8 keys have been recorded, the code jumps to the next instructions, at <code class="docutils literal"><span class="pre">0x009c</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>009c: 20 04 01 00    R4 &lt;- 0x0001
00a0: c1 0d 00 00    pop R13
00a4: 53 0d 02 00    Cmp(R13 - 0x0002)
00a8: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
00ac: c1 0d 00 00    pop R13
00b0: 53 0d 01 00    Cmp(R13 - 0x0001)
00b4: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
00b8: c1 0d 00 00    pop R13
00bc: 53 0d 02 00    Cmp(R13 - 0x0002)
00c0: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
00c4: c1 0d 00 00    pop R13
00c8: 53 0d 01 00    Cmp(R13 - 0x0001)
00cc: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
00d0: c1 0d 00 00    pop R13
00d4: 53 0d 04 00    Cmp(R13 - 0x0004)
00d8: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
00dc: c1 0d 00 00    pop R13
00e0: 53 0d 04 00    Cmp(R13 - 0x0004)
00e4: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
00e8: c1 0d 00 00    pop R13
00ec: 53 0d 08 00    Cmp(R13 - 0x0008)
00f0: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
00f4: c1 0d 00 00    pop R13
00f8: 53 0d 08 00    Cmp(R13 - 0x0008)
00fc: 17 01 0c 01    if !Z, call 0x010c&lt;set_0_to_r4&gt;
0100: 53 04 00 00    Cmp(R4 - 0x0000)
0104: 12 00 3c 01    if Z, jmp 0x013c&lt;show_failure_msg&gt;
0108: 14 00 14 01    call 0x0114&lt;show_good_msg&gt;

set_0_to_r4:
010c: 20 04 00 00    R4 &lt;- 0x0000
0110: 15 00 00 00    return
</pre></div>
</div>
<p>These instructions pop the 8 key presses in the opposite order they have been pushed on the stack and compares them with the sequence &#8220;2 1 2 1 4 4 8 8&#8221;.
If the key presses match this sequence, the code calls function <code class="docutils literal"><span class="pre">0x0114</span></code> which displays the winning message, draw an image and play some music.
Otherwise the code jumps to <code class="docutils literal"><span class="pre">0x013c</span></code>, which displays &#8220;Bad password !&#8221; and jumps back to <code class="docutils literal"><span class="pre">0x0014</span></code>, which prompts for the password again.</p>
<p>The password is therefore the sequence of key presses leading to the sequence &#8220;8 8 4 4 1 2 1 2&#8221; in I/O port <code class="docutils literal"><span class="pre">0xfff0</span></code>.</p>
<p>Both the already-mentioned wiki (<a class="reference external" href="https://github.com/chip16/chip16/wiki/Machine-Specification#controller-layout">https://github.com/chip16/chip16/wiki/Machine-Specification#controller-layout</a>) and the code of an emulator written in C++, <a class="reference external" href="https://github.com/refractionpcsx2/refchip16/blob/master/RefChip16/InputDevice.cpp#L69">https://github.com/refractionpcsx2/refchip16/blob/master/RefChip16/InputDevice.cpp#L69</a>, give the following key-binding:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Bit</span> <span class="mi">0</span> <span class="p">(</span><span class="n">value</span>   <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">Up</span>
<span class="n">Bit</span> <span class="mi">1</span> <span class="p">(</span><span class="n">value</span>   <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">Down</span>
<span class="n">Bit</span> <span class="mi">2</span> <span class="p">(</span><span class="n">value</span>   <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">Left</span>
<span class="n">Bit</span> <span class="mi">3</span> <span class="p">(</span><span class="n">value</span>   <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">Right</span>
<span class="n">Bit</span> <span class="mi">4</span> <span class="p">(</span><span class="n">value</span>  <span class="mi">16</span><span class="p">)</span> <span class="o">=</span> <span class="n">Select</span>
<span class="n">Bit</span> <span class="mi">5</span> <span class="p">(</span><span class="n">value</span>  <span class="mi">32</span><span class="p">)</span> <span class="o">=</span> <span class="n">Start</span>
<span class="n">Bit</span> <span class="mi">6</span> <span class="p">(</span><span class="n">value</span>  <span class="mi">64</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span> <span class="n">Button</span>
<span class="n">Bit</span> <span class="mi">7</span> <span class="p">(</span><span class="n">value</span> <span class="mi">128</span><span class="p">)</span> <span class="o">=</span> <span class="n">B</span> <span class="n">Button</span>
</pre></div>
</div>
<p>This allows to finally find the flag of the third Hack In Paris challenge: <strong>Right Right Left Left Up Down Up Down</strong>.</p>
</div>
<div class="section" id="appendix-additional-findings">
<h2>Appendix - Additional findings<a class="headerlink" href="#appendix-additional-findings" title="Permalink to this headline">¶</a></h2>
<p>When the correct password is entered, an image is displayed.
As this image uses a 16-bit palette (4 bits per pixel), it can be obtained with a hexadecimal dump (it is a 50x32 image):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ dd if=output.c16 bs=1 skip=$((0x1c8e+0x10)) | xxd -c50 -p
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeeeeffffffffffffffffffffffff
ffffffffffffffffffe8aaaaaaaaa8effffffffffffffffffffffffffffffffffffaaaaaaaaaaaaaa8ffffffffffffffffff
fffffffffffffffeaaaaaaaaaaaaaaaaaffffffffffffffffffffffffffffffffaaaaaaaaaa8aaaaaaaaffffffffffffffff
ffffffffffffffaaaaaaaaaaef9aaaaaaaaffffffffffffffffffffffffffffaaaaaaaaaaaff99aaaaaaa8ffffffffffffff
ffffffffffffeaaaaaaaaaaefe9999aaaaaaefffffffffffffffffffffffffaaaaaaaaaaaffe99999aaaaaefffffffffffff
ffffffffffffaaaaaaaaaaeffe9999999aaeaffffffffffffffffffffffff8aaaaaaaaaafff8999999988aa8ffffffffffff
fffffffffffaaaaaaaaaaffff899999aea9aaafffffffffffffffffffffff8eaaaaaaaaffffe88eeea99999affffffffffff
fffffffffffaaa8aaaaaffffffffff9999999afffffffffffffffffffffffaaaaa8ea8fffffffffa9999999affffffffffff
fffffffffffaaaaaaaaffffffffff99999999afffffffffffffffffffffffaaaaaaa8fffffffff8999999998ffffffffffff
fffffffffffeaaaaaaaaaea8ffffa99999999effffffffffffffffffffffffaaaaaaa88aa8fff888aaa999afffffffffffff
ffffffffffff8aaaa88aaaaefff99999aeeaeffffffffffffffffffffffffffaa88aaaaaaeffa99999999affffffffffffff
ffffffffffffff8aaaaaaaafff999999999effffffffffffffffffffffffffffaaaaaaaaaff899999999afffffffffffffff
fffffffffffffffaaaaaaaaff9999999aafffffffffffffffffffffffffffffffffaaaaaaf8999999affffffffffffffffff
ffffffffffffffffffeaaaa8a9999aefffffffffffffffffffffffffffffffffffffffe8aaaaaaefffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
</pre></div>
</div>
<p>Moreover a music is played.
The code uses the same code as <a class="reference external" href="https://github.com/tykel/midi16/blob/master/src/chip16.c#L28">https://github.com/tykel/midi16/blob/master/src/chip16.c#L28</a> to play a song from the data which lies at address <code class="docutils literal"><span class="pre">0x0f52</span></code>.
Each music note is encoded on 2 16-bit Little Endian integers: the first one for the pitch (in Hertz) and the second one for the sound duration (in milliseconds).
The music is the theme of Mortal Kombat, with some variations inside.</p>
<p>Finally the characters are displayed using a font at <code class="docutils literal"><span class="pre">0x0352</span></code>.
Each character of this font is a 8x8 image encoded on 32 bytes.
In fact the font bitmap which is used is <code class="docutils literal"><span class="pre">font.bmp</span></code> in a text printing sample program which can be found at <a class="reference external" href="https://github.com/chip16/chip16/tree/master/src/Samples/Text">https://github.com/chip16/chip16/tree/master/src/Samples/Text</a>: <a class="reference external" href="https://raw.githubusercontent.com/chip16/chip16/master/src/Samples/Text/font.bmp">https://raw.githubusercontent.com/chip16/chip16/master/src/Samples/Text/font.bmp</a></p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="challenge2.html">Hack In Paris Challenge 2</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="challenge4.html">Hack In Paris Challenge 4</a>&#160;&#160;»
        </p>

      </div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="challenge4.html" title="Hack In Paris Challenge 4"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="challenge2.html" title="Hack In Paris Challenge 2"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">HIPChall 2016 write-up</a> &raquo;</li> 
      </ul>
    </div>
  
    <!-- Original code from http://tholman.com/github-corners/ -->
    <a href="https://github.com/fishilico/hackinparis-2016" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg></a>
    <style>
      .github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}
      @keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}
      @media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
    </style>
  

    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Nicolas Iooss, beerware license.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>